# 要件定義書: 音楽理論・シーケンサー・作曲支援ツール

## プロジェクト情報
- **アプリ番号**: 00000001
- **ユニークID**: pe5xaf
- **要件番号**: [00000077]
- **プロジェクト名**: InteractiveMusic Composer & Theory Analyzer
- **生成日時**: 2025-07-28 16:20 JST
- **Worker AI**: Claude Sonnet 4
- **Workflow Version**: v0.17
- **System Version**: v0.30
- **バッチ内位置**: 5/∞個目

## 機能要件

### 1. 音楽理論分析機能
- **コード進行分析**: 入力されたコード進行の理論的分析
- **スケール分析**: メジャー・マイナー・モード分析
- **和声分析**: 機能和声・非機能和声の識別
- **コード推奨**: 次に適切なコードの提案システム

### 2. インタラクティブシーケンサー
- **16ステップシーケンサー**: クラシックなドラムマシン風UI
- **リアルタイム演奏**: Web Audio API による音源生成
- **BPM調整**: 60-200BPMの可変テンポ
- **パターン保存**: 最大8パターンの記録・切り替え

### 3. 仮想楽器機能
- **シンセサイザー**: オシレーター・フィルター・エンベロープ
- **ドラムキット**: キック・スネア・ハイハット等8音色
- **ベースライン**: 単音シーケンス機能
- **コードパッド**: 和音演奏パッド（8x4グリッド）

### 4. 作曲支援システム
- **コード進行ジェネレーター**: ジャンル別自動生成
- **メロディー提案**: スケール内での旋律候補提示
- **リズムパターン**: ジャンル別リズムテンプレート
- **楽理ヒント**: 理論的説明・アドバイス表示

### 5. 音楽可視化機能
- **リアルタイム波形**: 再生音の波形表示
- **音階表示**: ピアノロール風の音高可視化
- **和音構成音**: コードトーンのサークル表示
- **音楽スペクトラム**: 周波数分析ビジュアライザー

### 6. エクスポート・共有機能
- **MIDI出力**: シーケンスのMIDIファイル生成
- **音声録音**: WAV形式でのミックスダウン
- **プロジェクト保存**: ローカルストレージ活用
- **URLシェア**: パターン共有機能

## 技術要件

### パフォーマンス基準
- **レイテンシ**: <20ms の音響遅延
- **音質**: 44.1kHz/16bit CD品質
- **CPU使用率**: リアルタイム再生時<30%
- **UIレスポンス**: 操作反応<50ms

### 品質基準
- **音楽理論精度**: 和声分析正確率>95%
- **音響品質**: クリアな音質・ノイズレス
- **ユーザビリティ**: 音楽初心者にも直感的
- **レスポンシブ対応**: タブレット・デスクトップ対応

### 技術スタック
- **オーディオ**: Web Audio API
- **UI**: HTML5, CSS3, JavaScript (ES6+)
- **音楽理論**: カスタム理論エンジン
- **シーケンス**: 高精度タイミング制御

## 音楽理論仕様

### サポート音楽理論
- **調性**: メジャー・ナチュラルマイナー・ハーモニックマイナー
- **コード**: トライアド・7th・テンション・sus等
- **進行**: ii-V-I, vi-IV-I-V 等定番進行
- **モード**: ドリアン・ミクソリディアン等7モード

### コード分析アルゴリズム
```
1. 構成音抽出
2. 根音判定（最低音・3度積み重ね分析）
3. コードタイプ判定（長3度・短3度パターン）
4. テンション・オルタード判定
5. 機能分析（トニック・サブドミナント・ドミナント）
```

### スケール分析
```
音程パターン:
- メジャー: W-W-H-W-W-W-H
- ナチュラルマイナー: W-H-W-W-H-W-W
- ハーモニックマイナー: W-H-W-W-H-W+H-H
```

## シーケンサー仕様

### タイミング精度
- **基準**: 16分音符グリッド
- **タイミング補正**: クオンタイズ機能
- **スウィング**: 8分音符のシャッフル対応
- **同期**: 内部クロック・外部MIDI対応

### 音源仕様
```javascript
// シンセ設定例
const synthConfig = {
  oscillator: ['sine', 'square', 'sawtooth', 'triangle'],
  filter: { type: 'lowpass', frequency: 1000, Q: 1 },
  envelope: { attack: 0.1, decay: 0.2, sustain: 0.5, release: 0.3 }
};
```

## UI/UX要件

### インターフェース設計
- **シーケンサーグリッド**: 16x8の視覚的ステップ配置
- **楽器選択**: タブ方式での音源切り替え
- **理論パネル**: コード・スケール分析結果表示
- **トランスポート**: 再生・停止・録音コントロール

### 視覚的フィードバック
- **ステップインジケーター**: 現在再生位置のハイライト
- **音階可視化**: 押したキーの光度表示
- **波形表示**: リアルタイム音響フィードバック
- **コード図表**: 構成音の円形配置表示

### ユーザー体験
- **段階学習**: 音楽理論チュートリアル
- **即座演奏**: ワンクリックでの音出し
- **実験推奨**: 試行錯誤を促すUI設計
- **発見支援**: 新しい進行・メロディーの発見機能

## 制約事項

### 技術制約
- **ブラウザ互換**: Web Audio API対応ブラウザ
- **音響遅延**: ハードウェア・OS依存の遅延
- **同時発音**: ポリフォニー制限考慮
- **CPU負荷**: リアルタイム処理の計算量

### 音楽的制約
- **理論範囲**: 西洋音楽理論中心
- **音域**: 4オクターブ範囲（C2-C6）
- **同時発音**: 最大16音の和音対応
- **テンポ精度**: 人間の演奏感覚との調和

## 成功基準

### 機能面
- [ ] 16ステップシーケンサー完全動作
- [ ] 8種類楽器音源実装
- [ ] コード進行分析機能動作
- [ ] MIDI出力機能動作
- [ ] 音楽理論ヒント表示機能
- [ ] プロジェクト保存・読込み

### 性能面
- [ ] 音響遅延<20ms達成
- [ ] CPU使用率<30%維持
- [ ] UIレスポンス<50ms
- [ ] 和声分析正確率>95%

### 品質面
- [ ] 全ブラウザ動作確認
- [ ] 音質クリア・ノイズレス
- [ ] 音楽初心者にも使いやすい
- [ ] モバイル・デスクトップ対応

## 教育的価値

### 学習目標
- **音楽理論**: コード・スケールの基礎理解
- **作曲技法**: 効果的なコード進行パターン
- **リズム感**: グルーヴ・ビートの体感
- **音響学**: 波形・周波数の視覚的理解

### インタラクティブ学習
- **実践的理論**: 音を出しながらの理論学習
- **即座フィードバック**: 入力に対する理論的説明
- **実験環境**: 自由な音楽的探求の場
- **パターン発見**: 音楽法則の体験的理解

## 芸術的側面

### 創造性支援
- **偶然性**: ランダム要素による新発見
- **制約の美**: 限られたツールでの創造
- **即興性**: リアルタイム演奏の醍醐味
- **協調性**: 他者との音楽的対話可能性

### 美的表現
- **視覚的音楽**: 音を目で見る体験
- **抽象化**: 音楽構造の幾何学的表現
- **色彩設計**: 音高・和声に対応した色使い
- **動的美**: 時間軸上の音楽展開表現