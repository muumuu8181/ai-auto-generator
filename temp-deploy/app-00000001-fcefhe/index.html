<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šåˆ†é‡çµ±åˆå‹çŸ¥è­˜æ¢ç´¢ãƒ»å‰µé€ æ”¯æ´ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  | InterDisciplinary Discovery Hub</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
        }

        .app-container {
            display: grid;
            grid-template-areas: 
                "header header header"
                "sidebar main control"
                "footer footer footer";
            grid-template-rows: auto 1fr auto;
            grid-template-columns: 250px 1fr 300px;
            height: 100vh;
            gap: 1px;
            background: rgba(255,255,255,0.1);
        }

        .header {
            grid-area: header;
            background: rgba(0,0,0,0.3);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            color: #4fc3f7;
        }

        .mode-toggle {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255,107,107,0.4);
        }

        .sidebar {
            grid-area: sidebar;
            background: rgba(0,0,0,0.2);
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .main-view {
            grid-area: main;
            background: rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .control-panel {
            grid-area: control;
            background: rgba(0,0,0,0.2);
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .footer {
            grid-area: footer;
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            text-align: center;
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            backdrop-filter: blur(10px);
        }

        .knowledge-domain {
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            border-left: 4px solid;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .knowledge-domain:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }

        .domain-mathematics { border-left-color: #ff6b6b; }
        .domain-physics { border-left-color: #4ecdc4; }
        .domain-chemistry { border-left-color: #45b7d1; }
        .domain-biology { border-left-color: #96ceb4; }
        .domain-art { border-left-color: #ffeaa7; }
        .domain-music { border-left-color: #dda0dd; }
        .domain-language { border-left-color: #74b9ff; }
        .domain-philosophy { border-left-color: #fd79a8; }
        .domain-psychology { border-left-color: #fdcb6e; }
        .domain-technology { border-left-color: #6c5ce7; }

        .domain-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .domain-desc {
            font-size: 11px;
            opacity: 0.8;
        }

        #knowledge-network {
            width: 100%;
            height: 100%;
        }

        .control-section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }

        .control-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #4fc3f7;
        }

        .slider-container {
            margin: 10px 0;
        }

        .slider-label {
            font-size: 12px;
            margin-bottom: 5px;
            display: block;
        }

        .slider {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(255,255,255,0.3);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4fc3f7;
            cursor: pointer;
        }

        .insight-panel {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            border-left: 4px solid #4fc3f7;
        }

        .insight-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #4fc3f7;
        }

        .insight-content {
            font-size: 12px;
            line-height: 1.4;
        }

        .connection-strength {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .strength-high { background: #ff6b6b; }
        .strength-medium { background: #feca57; }
        .strength-low { background: #48dbfb; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .pulse { animation: pulse 2s infinite; }

        .floating-tooltip {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .active-connection {
            stroke-width: 3px !important;
            stroke: #ff6b6b !important;
            animation: pulse 1s infinite;
        }

        .node-highlight {
            stroke: #fff !important;
            stroke-width: 3px !important;
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-areas: 
                    "header"
                    "main"
                    "footer";
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
            }
            .sidebar, .control-panel {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="logo">ğŸ§  InterDisciplinary Discovery Hub</div>
            <div class="mode-toggle">
                <button class="btn" onclick="toggleExploreMode()">æ¢ç´¢ãƒ¢ãƒ¼ãƒ‰</button>
                <button class="btn" onclick="toggleCreateMode()">å‰µé€ ãƒ¢ãƒ¼ãƒ‰</button>
                <button class="btn" onclick="generateInsight()">æ´å¯Ÿç”Ÿæˆ</button>
            </div>
        </header>

        <aside class="sidebar">
            <h3 style="margin-bottom: 15px; color: #4fc3f7;">çŸ¥è­˜åˆ†é‡</h3>
            <div class="knowledge-domain domain-mathematics" onclick="focusDomain('mathematics')">
                <div class="domain-title">æ•°å­¦ãƒ»çµ±è¨ˆå­¦</div>
                <div class="domain-desc">ä»£æ•°ãƒ»å¹¾ä½•ãƒ»ç¢ºç‡ãƒ»æœ€é©åŒ–</div>
            </div>
            <div class="knowledge-domain domain-physics" onclick="focusDomain('physics')">
                <div class="domain-title">ç‰©ç†å­¦</div>
                <div class="domain-desc">é‡å­ãƒ»ç›¸å¯¾æ€§ãƒ»ç†±åŠ›å­¦ãƒ»æµä½“</div>
            </div>
            <div class="knowledge-domain domain-chemistry" onclick="focusDomain('chemistry')">
                <div class="domain-title">åŒ–å­¦</div>
                <div class="domain-desc">æœ‰æ©Ÿãƒ»ç„¡æ©Ÿãƒ»ç‰©ç†åŒ–å­¦ãƒ»åˆ†æ</div>
            </div>
            <div class="knowledge-domain domain-biology" onclick="focusDomain('biology')">
                <div class="domain-title">ç”Ÿç‰©å­¦</div>
                <div class="domain-desc">åˆ†å­ãƒ»ç´°èƒãƒ»é€²åŒ–ãƒ»ç”Ÿæ…‹ç³»</div>
            </div>
            <div class="knowledge-domain domain-art" onclick="focusDomain('art')">
                <div class="domain-title">èŠ¸è¡“ãƒ»ç¾å­¦</div>
                <div class="domain-desc">è¦–è¦šèŠ¸è¡“ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ç¾è¡“å²</div>
            </div>
            <div class="knowledge-domain domain-music" onclick="focusDomain('music')">
                <div class="domain-title">éŸ³æ¥½ç†è«–</div>
                <div class="domain-desc">å’Œå£°ãƒ»ãƒªã‚ºãƒ ãƒ»éŸ³éŸ¿ãƒ»ä½œæ›²</div>
            </div>
            <div class="knowledge-domain domain-language" onclick="focusDomain('language')">
                <div class="domain-title">è¨€èªå­¦</div>
                <div class="domain-desc">éŸ³éŸ»ãƒ»çµ±èªãƒ»æ„å‘³ãƒ»æ–‡å­—</div>
            </div>
            <div class="knowledge-domain domain-philosophy" onclick="focusDomain('philosophy')">
                <div class="domain-title">å“²å­¦ãƒ»è«–ç†å­¦</div>
                <div class="domain-desc">èªè­˜è«–ãƒ»å­˜åœ¨è«–ãƒ»å€«ç†å­¦</div>
            </div>
            <div class="knowledge-domain domain-psychology" onclick="focusDomain('psychology')">
                <div class="domain-title">å¿ƒç†å­¦</div>
                <div class="domain-desc">èªçŸ¥ãƒ»è¡Œå‹•ãƒ»ç¤¾ä¼šãƒ»ç™ºé”</div>
            </div>
            <div class="knowledge-domain domain-technology" onclick="focusDomain('technology')">
                <div class="domain-title">æƒ…å ±ç§‘å­¦</div>
                <div class="domain-desc">ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãƒ»AIãƒ»ãƒ‡ãƒ¼ã‚¿æ§‹é€ </div>
            </div>
        </aside>

        <main class="main-view">
            <svg id="knowledge-network"></svg>
        </main>

        <aside class="control-panel">
            <div class="control-section">
                <div class="control-title">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶å¾¡</div>
                <div class="slider-container">
                    <label class="slider-label">æ¥ç¶šå¼·åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</label>
                    <input type="range" class="slider" min="0" max="100" value="50" id="connectionStrength">
                </div>
                <div class="slider-container">
                    <label class="slider-label">è¡¨ç¤ºå¯†åº¦</label>
                    <input type="range" class="slider" min="10" max="100" value="70" id="displayDensity">
                </div>
                <div class="slider-container">
                    <label class="slider-label">ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦</label>
                    <input type="range" class="slider" min="1" max="10" value="5" id="animationSpeed">
                </div>
            </div>

            <div class="control-section">
                <div class="control-title">åˆ†æãƒ¢ãƒ¼ãƒ‰</div>
                <button class="btn" onclick="analyzePatterns()" style="width: 100%; margin-bottom: 10px;">ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ</button>
                <button class="btn" onclick="findBridges()" style="width: 100%; margin-bottom: 10px;">æ©‹æ¸¡ã—æ¦‚å¿µç™ºè¦‹</button>
                <button class="btn" onclick="clusterAnalysis()" style="width: 100%;">ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åˆ†æ</button>
            </div>

            <div class="insight-panel">
                <div class="insight-title">ğŸ” ç™ºè¦‹ã•ã‚ŒãŸæ´å¯Ÿ</div>
                <div class="insight-content" id="insightContent">
                    ç•°åˆ†é‡é–“ã®äºˆæƒ³å¤–ãªé–¢é€£æ€§ã‚’æ¢ç´¢ä¸­...
                    <br><br>
                    <span class="connection-strength strength-high"></span>æ•°å­¦ã¨éŸ³æ¥½ã®èª¿å’Œç†è«–
                    <br>
                    <span class="connection-strength strength-medium"></span>ç‰©ç†å­¦ã¨èŠ¸è¡“ã®å¯¾ç§°æ€§
                    <br>
                    <span class="connection-strength strength-low"></span>è¨€èªå­¦ã¨ç”Ÿç‰©å­¦ã®æ§‹é€ é¡ä¼¼
                </div>
            </div>

            <div class="control-section">
                <div class="control-title">å‰µé€ æ”¯æ´</div>
                <button class="btn" onclick="generateIdeaCombination()" style="width: 100%; margin-bottom: 10px;">ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢èåˆ</button>
                <button class="btn" onclick="suggestResearchTopics()" style="width: 100%; margin-bottom: 10px;">ç ”ç©¶ãƒ†ãƒ¼ãƒææ¡ˆ</button>
                <button class="btn" onclick="exportKnowledgeMap()" style="width: 100%;">çŸ¥è­˜ãƒãƒƒãƒ—å‡ºåŠ›</button>
            </div>
        </aside>

        <footer class="footer">
            InterDisciplinary Discovery Hub v1.0 | AI Auto Generator ws10-#10/10 | å¤šåˆ†é‡çµ±åˆå‹çŸ¥è­˜æ¢ç´¢ãƒ»å‰µé€ æ”¯æ´ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 
        </footer>
    </div>

    <div class="floating-tooltip" id="tooltip"></div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let networkData = null;
        let simulation = null;
        let currentMode = 'explore';
        let selectedDomain = null;
        let svg, g, nodes, links;

        // çŸ¥è­˜ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–
        function initializeKnowledgeNetwork() {
            const domains = [
                { id: 'mathematics', name: 'æ•°å­¦ãƒ»çµ±è¨ˆå­¦', color: '#ff6b6b', x: 0, y: 0 },
                { id: 'physics', name: 'ç‰©ç†å­¦', color: '#4ecdc4', x: 0, y: 0 },
                { id: 'chemistry', name: 'åŒ–å­¦', color: '#45b7d1', x: 0, y: 0 },
                { id: 'biology', name: 'ç”Ÿç‰©å­¦', color: '#96ceb4', x: 0, y: 0 },
                { id: 'art', name: 'èŠ¸è¡“ãƒ»ç¾å­¦', color: '#ffeaa7', x: 0, y: 0 },
                { id: 'music', name: 'éŸ³æ¥½ç†è«–', color: '#dda0dd', x: 0, y: 0 },
                { id: 'language', name: 'è¨€èªå­¦', color: '#74b9ff', x: 0, y: 0 },
                { id: 'philosophy', name: 'å“²å­¦ãƒ»è«–ç†å­¦', color: '#fd79a8', x: 0, y: 0 },
                { id: 'psychology', name: 'å¿ƒç†å­¦', color: '#fdcb6e', x: 0, y: 0 },
                { id: 'technology', name: 'æƒ…å ±ç§‘å­¦', color: '#6c5ce7', x: 0, y: 0 }
            ];

            // ã‚µãƒ–æ¦‚å¿µã‚’è¿½åŠ 
            const concepts = [];
            domains.forEach(domain => {
                concepts.push({ ...domain, type: 'domain', size: 20 });
                
                // å„ãƒ‰ãƒ¡ã‚¤ãƒ³ã«é–¢é€£æ¦‚å¿µã‚’è¿½åŠ 
                const relatedConcepts = generateRelatedConcepts(domain.id);
                relatedConcepts.forEach(concept => {
                    concepts.push({
                        id: `${domain.id}_${concept.id}`,
                        name: concept.name,
                        color: domain.color,
                        type: 'concept',
                        domain: domain.id,
                        size: Math.random() * 10 + 5,
                        x: 0,
                        y: 0
                    });
                });
            });

            // æ¥ç¶šé–¢ä¿‚ã‚’ç”Ÿæˆ
            const connections = generateConnections(concepts);

            networkData = {
                nodes: concepts,
                links: connections
            };

            createNetworkVisualization();
        }

        // é–¢é€£æ¦‚å¿µç”Ÿæˆ
        function generateRelatedConcepts(domainId) {
            const conceptMap = {
                mathematics: [
                    { id: 'algebra', name: 'ä»£æ•°å­¦' },
                    { id: 'geometry', name: 'å¹¾ä½•å­¦' },
                    { id: 'calculus', name: 'å¾®ç©åˆ†å­¦' },
                    { id: 'statistics', name: 'çµ±è¨ˆå­¦' },
                    { id: 'topology', name: 'ä½ç›¸æ•°å­¦' }
                ],
                physics: [
                    { id: 'quantum', name: 'é‡å­åŠ›å­¦' },
                    { id: 'relativity', name: 'ç›¸å¯¾æ€§ç†è«–' },
                    { id: 'thermodynamics', name: 'ç†±åŠ›å­¦' },
                    { id: 'electromagnetism', name: 'é›»ç£æ°—å­¦' },
                    { id: 'mechanics', name: 'åŠ›å­¦' }
                ],
                chemistry: [
                    { id: 'organic', name: 'æœ‰æ©ŸåŒ–å­¦' },
                    { id: 'inorganic', name: 'ç„¡æ©ŸåŒ–å­¦' },
                    { id: 'physical_chem', name: 'ç‰©ç†åŒ–å­¦' },
                    { id: 'analytical', name: 'åˆ†æåŒ–å­¦' },
                    { id: 'biochemistry', name: 'ç”ŸåŒ–å­¦' }
                ],
                biology: [
                    { id: 'molecular', name: 'åˆ†å­ç”Ÿç‰©å­¦' },
                    { id: 'evolution', name: 'é€²åŒ–è«–' },
                    { id: 'ecology', name: 'ç”Ÿæ…‹å­¦' },
                    { id: 'genetics', name: 'éºä¼å­¦' },
                    { id: 'neurobiology', name: 'ç¥çµŒç”Ÿç‰©å­¦' }
                ],
                art: [
                    { id: 'visual_art', name: 'è¦–è¦šèŠ¸è¡“' },
                    { id: 'sculpture', name: 'å½«åˆ»' },
                    { id: 'painting', name: 'çµµç”»' },
                    { id: 'design', name: 'ãƒ‡ã‚¶ã‚¤ãƒ³' },
                    { id: 'aesthetics', name: 'ç¾å­¦ç†è«–' }
                ],
                music: [
                    { id: 'harmony', name: 'å’Œå£°ç†è«–' },
                    { id: 'rhythm', name: 'ãƒªã‚ºãƒ ' },
                    { id: 'composition', name: 'ä½œæ›²æŠ€æ³•' },
                    { id: 'acoustics', name: 'éŸ³éŸ¿å­¦' },
                    { id: 'ethnomusicology', name: 'æ°‘æ—éŸ³æ¥½å­¦' }
                ],
                language: [
                    { id: 'phonetics', name: 'éŸ³éŸ»å­¦' },
                    { id: 'syntax', name: 'çµ±èªè«–' },
                    { id: 'semantics', name: 'æ„å‘³è«–' },
                    { id: 'pragmatics', name: 'èªç”¨è«–' },
                    { id: 'sociolinguistics', name: 'ç¤¾ä¼šè¨€èªå­¦' }
                ],
                philosophy: [
                    { id: 'logic', name: 'è«–ç†å­¦' },
                    { id: 'epistemology', name: 'èªè­˜è«–' },
                    { id: 'ethics', name: 'å€«ç†å­¦' },
                    { id: 'metaphysics', name: 'å½¢è€Œä¸Šå­¦' },
                    { id: 'philosophy_of_mind', name: 'å¿ƒã®å“²å­¦' }
                ],
                psychology: [
                    { id: 'cognitive', name: 'èªçŸ¥å¿ƒç†å­¦' },
                    { id: 'behavioral', name: 'è¡Œå‹•å¿ƒç†å­¦' },
                    { id: 'social_psych', name: 'ç¤¾ä¼šå¿ƒç†å­¦' },
                    { id: 'developmental', name: 'ç™ºé”å¿ƒç†å­¦' },
                    { id: 'neuropsychology', name: 'ç¥çµŒå¿ƒç†å­¦' }
                ],
                technology: [
                    { id: 'algorithms', name: 'ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ' },
                    { id: 'ai_ml', name: 'AIãƒ»æ©Ÿæ¢°å­¦ç¿’' },
                    { id: 'data_structures', name: 'ãƒ‡ãƒ¼ã‚¿æ§‹é€ ' },
                    { id: 'software_engineering', name: 'ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢å·¥å­¦' },
                    { id: 'cybernetics', name: 'ã‚µã‚¤ãƒãƒãƒ†ã‚£ã‚¯ã‚¹' }
                ]
            };
            return conceptMap[domainId] || [];
        }

        // æ¥ç¶šé–¢ä¿‚ç”Ÿæˆ
        function generateConnections(concepts) {
            const connections = [];
            
            // ãƒ‰ãƒ¡ã‚¤ãƒ³é–“æ¥ç¶š
            const domains = concepts.filter(c => c.type === 'domain');
            for (let i = 0; i < domains.length; i++) {
                for (let j = i + 1; j < domains.length; j++) {
                    const strength = calculateConnectionStrength(domains[i].id, domains[j].id);
                    if (strength > 0.3) {
                        connections.push({
                            source: domains[i].id,
                            target: domains[j].id,
                            strength: strength,
                            type: 'interdisciplinary'
                        });
                    }
                }
            }

            // ãƒ‰ãƒ¡ã‚¤ãƒ³å†…æ¥ç¶š
            domains.forEach(domain => {
                const domainConcepts = concepts.filter(c => c.domain === domain.id);
                domainConcepts.forEach(concept => {
                    connections.push({
                        source: domain.id,
                        target: concept.id,
                        strength: 0.8,
                        type: 'domain_concept'
                    });
                });
            });

            // æ¦‚å¿µé–“æ¥ç¶š
            const conceptNodes = concepts.filter(c => c.type === 'concept');
            for (let i = 0; i < conceptNodes.length; i++) {
                for (let j = i + 1; j < conceptNodes.length; j++) {
                    if (Math.random() < 0.15) {
                        const strength = Math.random() * 0.7 + 0.3;
                        connections.push({
                            source: conceptNodes[i].id,
                            target: conceptNodes[j].id,
                            strength: strength,
                            type: 'concept_concept'
                        });
                    }
                }
            }

            return connections;
        }

        // åˆ†é‡é–“æ¥ç¶šå¼·åº¦è¨ˆç®—
        function calculateConnectionStrength(domain1, domain2) {
            const strengthMatrix = {
                'mathematics-physics': 0.9,
                'mathematics-technology': 0.8,
                'mathematics-music': 0.7,
                'physics-chemistry': 0.8,
                'chemistry-biology': 0.9,
                'biology-psychology': 0.6,
                'art-psychology': 0.7,
                'music-mathematics': 0.7,
                'language-philosophy': 0.8,
                'technology-psychology': 0.6,
                'philosophy-psychology': 0.8,
                'art-music': 0.8,
                'physics-technology': 0.7,
                'language-technology': 0.6,
                'biology-chemistry': 0.9
            };

            const key1 = `${domain1}-${domain2}`;
            const key2 = `${domain2}-${domain1}`;
            
            return strengthMatrix[key1] || strengthMatrix[key2] || Math.random() * 0.6;
        }

        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¯è¦–åŒ–ä½œæˆ
        function createNetworkVisualization() {
            const container = d3.select('#knowledge-network');
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;

            container.selectAll("*").remove();

            svg = container
                .attr('width', width)
                .attr('height', height);

            g = svg.append('g');

            // ã‚ºãƒ¼ãƒ æ©Ÿèƒ½
            const zoom = d3.zoom()
                .scaleExtent([0.1, 4])
                .on('zoom', (event) => {
                    g.attr('transform', event.transform);
                });

            svg.call(zoom);

            // åŠ›å­¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            simulation = d3.forceSimulation(networkData.nodes)
                .force('link', d3.forceLink(networkData.links).id(d => d.id).distance(d => {
                    return d.type === 'domain_concept' ? 50 : 100;
                }))
                .force('charge', d3.forceManyBody().strength(d => {
                    return d.type === 'domain' ? -500 : -200;
                }))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(d => d.size + 10));

            // ãƒªãƒ³ã‚¯æç”»
            links = g.append('g')
                .selectAll('line')
                .data(networkData.links)
                .enter().append('line')
                .attr('stroke', d => {
                    const colors = {
                        'interdisciplinary': '#ff6b6b',
                        'domain_concept': '#4fc3f7',
                        'concept_concept': '#96ceb4'
                    };
                    return colors[d.type] || '#666';
                })
                .attr('stroke-width', d => Math.sqrt(d.strength * 5))
                .attr('stroke-opacity', d => d.strength);

            // ãƒãƒ¼ãƒ‰æç”»
            nodes = g.append('g')
                .selectAll('circle')
                .data(networkData.nodes)
                .enter().append('circle')
                .attr('r', d => d.size)
                .attr('fill', d => d.color)
                .attr('stroke', '#fff')
                .attr('stroke-width', 2)
                .style('cursor', 'pointer')
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended))
                .on('mouseover', handleMouseOver)
                .on('mouseout', handleMouseOut)
                .on('click', handleNodeClick);

            // ãƒ©ãƒ™ãƒ«æç”»
            const labels = g.append('g')
                .selectAll('text')
                .data(networkData.nodes)
                .enter().append('text')
                .text(d => d.name)
                .attr('font-size', d => d.type === 'domain' ? '12px' : '10px')
                .attr('font-weight', d => d.type === 'domain' ? 'bold' : 'normal')
                .attr('fill', '#fff')
                .attr('text-anchor', 'middle')
                .attr('dy', '.35em')
                .style('pointer-events', 'none');

            // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
            simulation.on('tick', () => {
                links
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);

                nodes
                    .attr('cx', d => d.x)
                    .attr('cy', d => d.y);

                labels
                    .attr('x', d => d.x)
                    .attr('y', d => d.y);
            });

            startNetworkAnimation();
        }

        // ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆ
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
        function handleMouseOver(event, d) {
            const tooltip = d3.select('#tooltip');
            tooltip.style('opacity', 1)
                .html(`<strong>${d.name}</strong><br>åˆ†é‡: ${d.domain || d.id}<br>ã‚¿ã‚¤ãƒ—: ${d.type}`)
                .style('left', (event.pageX + 10) + 'px')
                .style('top', (event.pageY - 10) + 'px');

            d3.select(this).classed('node-highlight', true);
            
            // é–¢é€£ãƒªãƒ³ã‚¯ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            links.classed('active-connection', l => l.source.id === d.id || l.target.id === d.id);
        }

        function handleMouseOut(event, d) {
            d3.select('#tooltip').style('opacity', 0);
            d3.select(this).classed('node-highlight', false);
            links.classed('active-connection', false);
        }

        function handleNodeClick(event, d) {
            if (d.type === 'domain') {
                focusDomain(d.id);
            } else {
                showConceptDetails(d);
            }
        }

        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        function startNetworkAnimation() {
            setInterval(() => {
                if (currentMode === 'explore') {
                    // ãƒ©ãƒ³ãƒ€ãƒ ãªæ¥ç¶šã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                    const randomLink = networkData.links[Math.floor(Math.random() * networkData.links.length)];
                    links.classed('active-connection', false);
                    links.filter(l => l === randomLink).classed('active-connection', true);
                    
                    setTimeout(() => {
                        links.classed('active-connection', false);
                    }, 2000);
                }
            }, 5000);
        }

        // UIåˆ¶å¾¡é–¢æ•°
        function toggleExploreMode() {
            currentMode = 'explore';
            updateInsight('æ¢ç´¢ãƒ¢ãƒ¼ãƒ‰: çŸ¥è­˜é–“ã®é–¢é€£æ€§ã‚’ç™ºè¦‹ã—ã¦ã„ã¾ã™...');
        }

        function toggleCreateMode() {
            currentMode = 'create';
            updateInsight('å‰µé€ ãƒ¢ãƒ¼ãƒ‰: æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ã®çµ„ã¿åˆã‚ã›ã‚’ç”Ÿæˆä¸­...');
        }

        function focusDomain(domainId) {
            selectedDomain = domainId;
            
            // ãƒãƒ¼ãƒ‰ã®å¼·èª¿è¡¨ç¤º
            nodes.style('opacity', d => d.id === domainId || d.domain === domainId ? 1 : 0.3);
            links.style('opacity', l => 
                l.source.id === domainId || l.target.id === domainId || 
                l.source.domain === domainId || l.target.domain === domainId ? 1 : 0.1
            );

            updateInsight(`${domainId}åˆ†é‡ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ä¸­ã€‚é–¢é€£æ¦‚å¿µã¨ä»–åˆ†é‡ã¨ã®æ¥ç¶šã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚`);
        }

        function generateInsight() {
            const insights = [
                "æ•°å­¦ã®å¯¾ç§°æ€§ç†è«–ã¨éŸ³æ¥½ã®å’Œå£°æ§‹é€ ã«å…±é€šã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç™ºè¦‹ï¼",
                "é‡å­ç‰©ç†å­¦ã®ä¸ç¢ºå®šæ€§åŸç†ã¨èŠ¸è¡“è¡¨ç¾ã®æ›–æ˜§æ€§ã«é¡ä¼¼æ€§ã‚’ç™ºè¦‹ï¼",
                "è¨€èªå­¦ã®æ§‹é€ ä¸»ç¾©ã¨ç”Ÿç‰©å­¦ã®åˆ†é¡ä½“ç³»ã«å…±é€šã®éšå±¤æ§‹é€ ã‚’ç™ºè¦‹ï¼",
                "å¿ƒç†å­¦ã®èªçŸ¥ãƒã‚¤ã‚¢ã‚¹ã¨å“²å­¦ã®è«–ç†çš„èª¤è¬¬ã«é–¢é€£æ€§ã‚’ç™ºè¦‹ï¼",
                "åŒ–å­¦ã®åå¿œæ©Ÿæ§‹ã¨ç¤¾ä¼šã‚·ã‚¹ãƒ†ãƒ ã®å¤‰åŒ–ãƒ—ãƒ­ã‚»ã‚¹ã«é¡ä¼¼ç‚¹ã‚’ç™ºè¦‹ï¼"
            ];
            
            const randomInsight = insights[Math.floor(Math.random() * insights.length)];
            updateInsight(randomInsight);
            
            // è¦–è¦šçš„åŠ¹æœ
            nodes.classed('pulse', true);
            setTimeout(() => {
                nodes.classed('pulse', false);
            }, 3000);
        }

        function analyzePatterns() {
            updateInsight('ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æå®Ÿè¡Œä¸­: çŸ¥è­˜ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ§‹é€ çš„ç‰¹å¾´ã‚’è§£æã—ã¦ã„ã¾ã™...');
            
            setTimeout(() => {
                const analysis = {
                    clusters: Math.floor(Math.random() * 5) + 3,
                    bridges: Math.floor(Math.random() * 8) + 5,
                    density: (Math.random() * 0.4 + 0.3).toFixed(2)
                };
                
                updateInsight(`åˆ†æçµæœ: ${analysis.clusters}å€‹ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã€${analysis.bridges}å€‹ã®æ©‹æ¸¡ã—æ¦‚å¿µã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¯†åº¦${analysis.density}ã‚’æ¤œå‡ºã€‚`);
            }, 2000);
        }

        function findBridges() {
            updateInsight('æ©‹æ¸¡ã—æ¦‚å¿µæ¢ç´¢ä¸­: åˆ†é‡é–“ã‚’ç¹‹ãé‡è¦ãªæ¦‚å¿µã‚’ç‰¹å®šã—ã¦ã„ã¾ã™...');
            
            // æ©‹æ¸¡ã—æ¦‚å¿µã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            const bridgeConcepts = networkData.nodes.filter(n => Math.random() < 0.2);
            nodes.style('stroke', d => bridgeConcepts.includes(d) ? '#ff6b6b' : '#fff');
            nodes.style('stroke-width', d => bridgeConcepts.includes(d) ? 4 : 2);
        }

        function clusterAnalysis() {
            updateInsight('ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åˆ†æå®Ÿè¡Œä¸­: é–¢é€£æ¦‚å¿µã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã‚’è¡Œã£ã¦ã„ã¾ã™...');
            
            // ç°¡æ˜“ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼è¡¨ç¤º
            const clusterColors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7'];
            nodes.attr('fill', d => {
                if (d.type === 'domain') return d.color;
                return clusterColors[Math.floor(Math.random() * clusterColors.length)];
            });
        }

        function generateIdeaCombination() {
            const combinations = [
                "é‡å­éŸ³æ¥½å­¦: é‡å­åŠ›å­¦ã®é‡ã­åˆã‚ã›åŸç†ã‚’éŸ³æ¥½ä½œæ›²ã«å¿œç”¨",
                "ãƒã‚¤ã‚ªãƒ¡ãƒˆãƒªãƒƒã‚¯è©©å­¦: ç”Ÿä½“ãƒªã‚ºãƒ ã‹ã‚‰è©©ã®éŸ»å¾‹ã‚’è‡ªå‹•ç”Ÿæˆ",
                "ãƒ•ãƒ©ã‚¯ã‚¿ãƒ«å»ºç¯‰å­¦: æ•°å­¦çš„ãƒ•ãƒ©ã‚¯ã‚¿ãƒ«æ§‹é€ ã®å»ºç¯‰ãƒ‡ã‚¶ã‚¤ãƒ³å¿œç”¨",
                "ç¥çµŒè¨€èªå­¦çš„çµµç”»: è„³æ³¢ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰è¦–è¦šèŠ¸è¡“ã‚’å‰µé€ ",
                "åŒ–å­¦çš„èª¿å’Œè«–: åˆ†å­ã®æŒ¯å‹•å‘¨æ³¢æ•°ã‹ã‚‰æ–°ã—ã„éŸ³éšã‚·ã‚¹ãƒ†ãƒ "
            ];
            
            const randomCombination = combinations[Math.floor(Math.random() * combinations.length)];
            updateInsight(`ğŸ’¡ å‰µé€ çš„ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢: ${randomCombination}`);
        }

        function suggestResearchTopics() {
            const topics = [
                "èªçŸ¥ç§‘å­¦Ã—èŠ¸è¡“: å‰µé€ æ€§ã®ç¥çµŒãƒ¡ã‚«ãƒ‹ã‚ºãƒ è§£æ˜",
                "æ•°å­¦Ã—ç”Ÿç‰©å­¦: ç”Ÿç‰©å½¢æ…‹ã®ãƒˆãƒãƒ­ã‚¸ã‚«ãƒ«åˆ†æ",
                "ç‰©ç†å­¦Ã—å“²å­¦: é‡å­åŠ›å­¦ã®å­˜åœ¨è«–ã¸ã®å½±éŸ¿",
                "è¨€èªå­¦Ã—éŸ³æ¥½: è¨€èªãƒªã‚ºãƒ ã¨éŸ³æ¥½ãƒªã‚ºãƒ ã®æ™®éæ€§",
                "åŒ–å­¦Ã—å¿ƒç†å­¦: ç¥çµŒä¼é”ç‰©è³ªã¨æ„Ÿæƒ…ã®åŒ–å­¦çš„åŸºç›¤"
            ];
            
            const randomTopic = topics[Math.floor(Math.random() * topics.length)];
            updateInsight(`ğŸ”¬ ç ”ç©¶ãƒ†ãƒ¼ãƒææ¡ˆ: ${randomTopic}`);
        }

        function exportKnowledgeMap() {
            const exportData = {
                nodes: networkData.nodes.length,
                links: networkData.links.length,
                timestamp: new Date().toISOString(),
                selectedDomain: selectedDomain,
                mode: currentMode
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'knowledge_map_export.json';
            link.click();
            
            updateInsight('çŸ¥è­˜ãƒãƒƒãƒ—ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸã€‚');
        }

        function updateInsight(text) {
            document.getElementById('insightContent').innerHTML = text;
        }

        function showConceptDetails(concept) {
            updateInsight(`æ¦‚å¿µè©³ç´°: ${concept.name} (${concept.domain}åˆ†é‡)`);
        }

        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('connectionStrength').addEventListener('input', function(e) {
            const threshold = e.target.value / 100;
            links.style('opacity', d => d.strength >= threshold ? d.strength : 0.1);
        });

        document.getElementById('displayDensity').addEventListener('input', function(e) {
            const density = e.target.value / 100;
            nodes.style('opacity', d => Math.random() < density ? 1 : 0.3);
        });

        document.getElementById('animationSpeed').addEventListener('input', function(e) {
            const speed = e.target.value;
            simulation.alphaDecay(0.01 * speed);
        });

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeKnowledgeNetwork();
            updateInsight('InterDisciplinary Discovery Hub ã¸ã‚ˆã†ã“ãï¼ç•°åˆ†é‡é–“ã®çŸ¥è­˜ã‚’æ¢ç´¢ã—ã€æ–°ã—ã„ç™ºè¦‹ã‚’æ¥½ã—ã‚“ã§ãã ã•ã„ã€‚');
        });

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
        window.addEventListener('resize', function() {
            if (networkData) {
                setTimeout(createNetworkVisualization, 100);
            }
        });
    </script>
</body>
</html>